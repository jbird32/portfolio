<head>
               <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
			   <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.20.2/math.js" type="text/javascript"></script>
			   
			   <title>LU Decomposition</title>
</head>

<h3>[LU Decomposition Calculator]</h3>
<div style ='padding:10px' font= 'Verdana'><p>Factors a non-singular matrix "A" into 3 component matrices: <br><br>
P: a permutation matrix that records row swaps<br>
L: a lower triangular matrix<br>
U: an upper triangular matrix<br><br>
Where A=PLU</p></div>
<br><br>
Matrix: &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp(with example input)
<form id="matrix">
 </form> 
  
  <textarea id="A" type="text"  style = 'width:400px;height:300px'> 
  [
  [1, 0, 2, 3],
  [6, 2, 6, 1],
  [0, 0, 1, 2],
  [1, 2, 3, 4]
	     ]</textarea><br>

<button id = 'submit'>Factor</button>



<h3>P:</h3>
<div class = 'matrix' style = "width:1500px;height:300px;"> 
	
	<table id ='Pmat'style="width:1500px;height:300px;display: inline-block"> </table>
</div>
<h3>L:</h3>
<div class = 'matrix' style = "width:1500px;height:300px;"> 
	
	<table id ='Lmat'style="width:1500px;height:300px;display: inline-block"> </table>
</div>
<h3>U:</h3>
<div class = 'matrix 'style = "width:1500px;height:300px;"> 
	
	<table id ='Umat'style="width:1500px;height:300px;display: inline-block"> </table>
</div>
<div style = "width:1500px;height:300px;"> </div>

<style media="screen" type="text/css">

body {
    background-color: linen;
}

.matrix {
    padding: 10px;
    margin-left: 40px;
}
</style>






<script>
math.config({
  number: 'BigNumber', // Default type of number:
                       // 'number' (default), 'BigNumber', or 'Fraction'
  precision: 64        // Number of significant digits for BigNumbers
});
////////////////////////////////////////////////////////////////////
function triangularize (A){
	if(A[0].length==A.length){ 

	if ( math.det(A)!=0  ){
	var P=iMat(A.length);
	
	
	var U=[];
	   for (var i=0; i<A.length; i++)  
		   U[i]=A[i].slice(0);

	var k=0;
	for (k=0; k<U.length; k++){
	  for (var j=1; j<U.length-k; j++){//pivot here
		
		var count=1;
		while(Math.abs(U[k][k])<.000000001){//swap rows if pivot is 0
			
			var tempmat=[];
			for (var u=0; u<A.length; u++) //temp U 
			tempmat[u]=U[u].slice(0);
			
			var temp=U[k].slice(0);
			U[k]=U[k+count].slice(0);
			U[k+count]=temp.slice(0);
			count++;
			P = math.multiply(math.multiply(U, math.inv(tempmat)), P);     //P*old=new ----> P=new*old^-1
		}
		
		
		var rowx = U[k].map(x => x*(U[j+k][k]/U[k][k])); 
	   	
			for (var i=0; i<U.length; i++){
				U[j+k][i]=U[j+k][i]-rowx[i];
	   	} 
	  }
	
	}
	 var L=getL(A, U);
	 L = math.multiply(P, L);
	 P = math.inv(P);
	
	return {
	
	
	U: U, 
	P: P,
	L: L
	};
	//LU not unique unless 1s on the diagonal.
//for better accuracy find pivot with largest absolute value and swap rows
	}}//det check
	alert('Please enter a non-singular, square matrix');
}
/////////////////////////////////////////////////////////////////////
function getL(A, U){

	return math.multiply(A, math.inv(U)); //A=LU ---> A*U^-1 = L
	
}
////////////////////////////////////////////////////////////////////////finds permutation matrix Pn
//use to push P onto a stack of permutation matrices whenever a row is switched to multiply L back into lower triangular.
//After L is found simply do the same row switches to get to lower tri. ie PnP3P2P1*L


//////////////////////////////////////////////0s out tiny numbers and forces precision to 4 decimals (rounds not truncates)
function clip (A){

	for (var l=0; l<A.length; l++){
			for(var m = 0; m<A.length; m++){
				
				
				if (Math.abs(A[l][m])< 0.0000000000009)
					A[l][m]=0.0000;
			
				A[l][m] = A[l][m].toFixed(4)
			}
			
		}
		return A;
}

//////////////////////////////////////////////generates an identity matrix
function iMat (N){

	var I = [];
	for (var i=0; i<N; i++)
	I.push([]);
	
	for (var j=0; j<N; j++){
		for (var i=0; i<N; i++)
		I[j][i]=0;
		I[j][j]=1;
		}
		
	return I;
}
//////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////main



//A = [[0, 1, 1, 0],[4, 0, 3, 1],[8, 7, 0, 5],[0, 0, 0, 0]];// 0determinant test
//A = [[0, 1, 1, 0],[4, 0, 3, 1],[8, 7, 0, 5]];//nonsquare test



//This is the matrix that is supposed to be read in from the user
A = [

[0, 1, .9, 5, 2, 1],
[0, 1, 3, 1, 7, 95],
[2, 0, 1, 0, 4, 12],
[6, 0, .09, 8, 1, 11], 
[1, 6, 3, 0, 0, 1],
[1, 15, 7, .04, 9, 2]

];

var submit = document.getElementById('submit');
submit.onclick = function(){
	
	var A = eval(document.getElementById('A').value);
	//console.log(A);
	console.log(triangularize(A));
	
	
	var U=clip(triangularize(A).U);
	var P=clip(triangularize(A).P);
	var L=clip(triangularize(A).L);


var tableP = document.getElementById("Pmat");
var tableL = document.getElementById("Lmat");
var tableU = document.getElementById("Umat");

				tableP.innerHTML =  '';
				tableL.innerHTML =  '';
				tableU.innerHTML =  '';
for (i=0; i<A.length; i++) {
		    
			    tableP.innerHTML += '<tr>' 
				tableL.innerHTML += '<tr>' 
				tableU.innerHTML += '<tr>' //"<br><br>";
    for (j=0; j<A[i].length; j++) {
        tableP.innerHTML+= P[i][j]+' &nbsp'+'&nbsp'+'&nbsp'+'&nbsp'+'&nbsp';
		tableL.innerHTML+= L[i][j]+' &nbsp'+'&nbsp'+'&nbsp'+'&nbsp'+'&nbsp';
		tableU.innerHTML+= U[i][j]+' &nbsp'+'&nbsp'+'&nbsp'+'&nbsp'+'&nbsp';
		if (i==A.length-1)	tableU.innerHTML += '</tr>'			
   }
}

console.log(clip(math.multiply(P, L, U)));  //A=PLU
}
//console.log(triangularize(A));





</script>
